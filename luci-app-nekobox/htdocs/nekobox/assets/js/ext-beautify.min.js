define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],function(e,S,t){"use strict";function K(e,t){return-1<e.type.lastIndexOf(t+".xml")}var L=e("../token_iterator").TokenIterator;S.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],S.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],S.formatOptions={lineBreaksAfterCommasInCurlyBlock:!0},S.beautify=function(e){for(var t,r,a,o,s,n=new L(e,0,0),i=n.getCurrentToken(),c=e.getTabString(),l=S.singletonTags,m=S.blockTags,u=S.formatOptions||{},p=!1,f=!1,h=!1,y="",d="",g="",b=0,k=0,$=0,w=0,v=0,x=0,T=0,C=0,R=!1,B=!1,O=!1,I={0:0},q=[],_=!1,j=function(){t&&t.value&&"string.regexp"!==t.type&&(t.value=t.value.replace(/^\s*/,""))},A=function(){for(var e=y.length-1;0!=e&&" "===y[e];)--e;y=y.slice(0,e+1)},F=function(){y=y.trimRight(),p=!1};null!==i;){if(a=n.getCurrentTokenRow(),n.$rowTokens,t=n.stepForward(),void 0!==i){if(d=i.value,v=0,s="style"===g||"ace/mode/css"===e.$modeId,K(i,"tag-open")?(B=!0,t&&(O=-1!==m.indexOf(t.value)),"</"===d&&(O&&!p&&C<1&&C++,s&&(C=1),O=!(v=1))):K(i,"tag-close")?B=!1:K(i,"comment.start")?O=!0:K(i,"comment.end")&&(O=!1),B||C||"paren.rparen"!==i.type||"}"!==i.value.substr(0,1)||C++,a!==r&&(C=a,r&&(C-=r)),C){for(F();0<C;C--)y+="\n";p=!0,K(i,"comment")||i.type.match(/^(comment|string)$/)||(d=d.trimLeft())}if(d){if("keyword"===i.type&&d.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(q[b]=d,j(),h=!0,d.match(/^(else|elseif)$/)&&y.match(/\}[\s]*$/)&&(F(),f=!0)):"paren.lparen"===i.type?(j(),"{"===d.substr(-1)&&(R=!(h=!0),B||(C=1)),"{"===d.substr(0,1)&&(f=!0,"["!==y.substr(-1)&&"["===y.trimRight().substr(-1)?(F(),f=!1):(")"===y.trimRight().substr(-1)?F:A)())):"paren.rparen"===i.type?("}"===d.substr(0,v=1)&&("case"===q[b-1]&&v++,"{"===y.trimRight().substr(-1)?F():(f=!0,s&&(C+=2))),"]"===d.substr(0,1)&&"}"!==y.substr(-1)&&"}"===y.trimRight().substr(-1)&&(f=!1,w++,F()),")"===d.substr(0,1)&&"("!==y.substr(-1)&&"("===y.trimRight().substr(-1)&&(f=!1,w++,F()),A()):"keyword.operator"!==i.type&&"keyword"!==i.type||!d.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===i.type&&";"===d?(F(),j(),h=!0,s&&C++):"punctuation.operator"===i.type&&d.match(/^(:|,)$/)?(F(),j(),d.match(/^(,)$/)&&0<T&&0===x&&u.lineBreaksAfterCommasInCurlyBlock?C++:p=!(h=!0)):"support.php_tag"!==i.type||"?>"!==d||p?K(i,"attribute-name")&&y.substr(-1).match(/^\s$/)?f=!0:K(i,"attribute-equals")?(A(),j()):K(i,"tag-close")?(A(),"/>"===d&&(f=!0)):"keyword"===i.type&&d.match(/^(case|default)$/)&&_&&(v=1):(F(),f=!0):(F(),j(),h=f=!0),p&&(!i.type.match(/^(comment)$/)||d.substr(0,1).match(/^[/#]$/))&&(!i.type.match(/^(string)$/)||d.substr(0,1).match(/^['"@]$/))){if(w=$,k<b)for(w++,o=b;k<o;o--)I[o]=w;else b<k&&(w=I[b]);for(k=b,$=w,v&&(w-=v),R&&!x&&(w++,R=!1),o=0;o<w;o++)y+=c}if("keyword"===i.type&&d.match(/^(case|default)$/)?!1===_&&(q[b]=d,b++,_=!0):"keyword"===i.type&&d.match(/^(break)$/)&&q[b-1]&&q[b-1].match(/^(case|default)$/)&&(b--,_=!1),"paren.lparen"===i.type&&(x+=(d.match(/\(/g)||[]).length,T+=(d.match(/\{/g)||[]).length,b+=d.length),"keyword"===i.type&&d.match(/^(if|else|elseif|for|while)$/)?(R=!0,x=0):!x&&d.trim()&&"comment"!==i.type&&(R=!1),"paren.rparen"===i.type)for(x-=(d.match(/\)/g)||[]).length,T-=(d.match(/\}/g)||[]).length,o=0;o<d.length;o++)b--,"}"===d.substr(o,1)&&"case"===q[b]&&b--;"text"==i.type&&(d=d.replace(/\s+$/," ")),f&&!p&&(A(),"\n"!==y.substr(-1)&&(y+=" ")),y+=d,h&&(y+=" "),h=f=p=!1,(K(i,"tag-close")&&(O||-1!==m.indexOf(g))||K(i,"doctype")&&">"===d)&&(C=O&&t&&"</"===t.value?-1:1),t&&-1===l.indexOf(t.value)&&(K(i,"tag-open")&&"</"===d?b--:K(i,"tag-open")&&"<"===d?b++:K(i,"tag-close")&&"/>"===d&&b--),K(i,"tag-name")&&(g=d),r=a}}i=t}y=y.trim(),e.doc.setValue(y)},S.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){S.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]}),window.require(["ace/ext/beautify"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)});